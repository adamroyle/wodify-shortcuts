service: wodify-client-api
# app and org for use with dashboard.serverless.com
# app: wodify-client-api
# org: adamroyle

# You can pin your service to only deploy with a specific Serverless version
# Check out our docs for more details
frameworkVersion: '3'

constructs:
  bucket:
    type: storage

provider:
  name: aws
  runtime: nodejs14.x
  versionFunctions: false
  environment:
    BUCKET: ${construct:bucket.bucketName}

# you can overwrite defaults here
#  stage: dev
#  region: us-east-1

functions:
  receiveRequest:
    handler: handler.receiveRequest
    events:
      - httpApi:
          path: /
          method: get
  processRequest:
    handler: handler.processRequest
    timeout: 40
    events:
      - s3:
          bucket: ${construct:bucket.bucketName}
          existing: true
          forceDeploy: true
          event: s3:ObjectCreated:Put
          rules:
            - prefix: request/

plugins:
  - serverless-plugin-typescript
  - serverless-lift
